<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Funland</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
  <body>
    <div id="startup_banner" class="banner hidden"><span class="spinner" aria-hidden="true"></span><span id="startup_msg">系统初始化中，请稍候...</span></div>
  <div class="app">
    <header class="topbar">
      <div class="brand">AI Funland</div>
      <nav class="nav">
        <a href="#chat" class="navlink" data-page="chat">聊天</a>
        <a href="#t2i" class="navlink" data-page="t2i">文生图</a>
        <a href="#models" class="navlink" data-page="models">模型管理</a>
        <a href="#settings" class="navlink" data-page="settings">系统配置</a>
        <a href="#about" class="navlink" data-page="about">关于</a>
      </nav>
      <div class="controls">
        <select id="lang" aria-label="Language">
          <option value="en">English</option>
          <option value="zh">中文</option>
        </select>
        <select id="accelerator" aria-label="Accelerator"></select>
        <button id="btn_release_global" data-i18n="release" aria-label="Release model">Release</button>
        <button id="btn_pipeline_top" aria-label="Pipeline iGPU+NPU">一键管线</button>
        <span id="pipeline_status" aria-label="Pipeline status">未启用</span>
      </div>
    </header>
    
    <main>
      <section id="page_chat" class="page">
        <div class="chat-layout">
          <section class="card chat-main">
            <div class="row">
              <select id="model_select" class="grow" aria-label="Model"></select>
            </div>
            <div id="no_models_hint" class="hint" style="display:none"><span data-i18n="no_models_hint">在模型管理中下载模型</span> · <a href="#models" data-page="models" data-i18n="goto_models">前往模型管理</a></div>
            <div id="alert" class="alert" style="display:none"><span class="icon" aria-hidden="true">⚠️</span><div id="alert_msg" role="alert"></div></div>
            <div id="chat_msgs" class="chat" role="log" aria-live="polite"></div>
            <div class="chat-input">
              <textarea id="prompt" placeholder="输入你的问题" rows="4" aria-label="Prompt"></textarea>
              <div class="row">
                <button id="btn_generate" data-i18n="generate" aria-label="Generate">发送</button>
              </div>
            <div class="row small">
                <label><input type="checkbox" id="use_ctx" checked> 使用上下文</label>
                <label><input type="checkbox" id="deep_think"> 深度思考</label>
                <label><input type="checkbox" id="web_search"> 联网检索</label>
            </div>
              <div class="row">
                <input id="chat_search" class="grow" placeholder="搜索历史（预留）" aria-label="Search history">
              </div>
            </div>
          </section>
          <aside class="card chat-side" id="thinking_card">
            <div class="card-header">
              <h2>Thinking</h2>
              <button id="think_toggle" aria-label="Toggle">▾</button>
            </div>
            <div id="thinking_content" class="output"></div>
            <div id="thinking_summary" class="output" style="display:none"></div>
          <div class="card-actions">
            <button id="think_copy" aria-label="Copy">复制</button>
          </div>
          <div class="foot" id="sys_hw"></div>
          <div class="foot" id="sys_load"></div>
        </aside>
        </div>
      </section>
      <section id="page_t2i" class="page">
        <section class="card">
          <h2>预置模型推荐</h2>
          <div class="row">
            <select id="t2i_preset_select" class="grow" aria-label="Preset Models"></select>
            <button id="btn_t2i_ms_fp16">ModelScope下载并转换FP16</button>
            <button id="btn_t2i_ms_int8">ModelScope下载并转换INT8</button>
          </div>
        </section>
        <section class="card">
          <h2>文本生成图片</h2>
          <div class="row">
            <input id="t2i_model_path" class="grow" placeholder="模型目录(已转换为OpenVINO)" aria-label="Model path">
          </div>
          <div class="row small">
            <label>TextEncoder</label>
            <select id="t2i_device_te" aria-label="TE Device"></select>
            <label>UNet</label>
            <select id="t2i_device_unet" aria-label="UNet Device"></select>
            <label>VAE</label>
            <select id="t2i_device_vae" aria-label="VAE Device"></select>
          </div>
          <div class="row small">
            <input id="t2i_width" type="number" value="512" min="64" step="64" aria-label="Width">
            <input id="t2i_height" type="number" value="512" min="64" step="64" aria-label="Height">
            <input id="t2i_steps" type="number" value="30" min="1" step="1" aria-label="Steps">
            <input id="t2i_guidance" type="number" value="7.5" step="0.1" aria-label="Guidance">
          </div>
          <div class="row">
            <textarea id="t2i_prompt" rows="3" placeholder="输入提示词" aria-label="Prompt"></textarea>
          </div>
          <div class="row">
            <button id="btn_t2i_generate" aria-label="Generate Image">生成图片</button>
          </div>
          <div class="row">
            <div id="t2i_status"></div>
          </div>
          <div class="row">
            <img id="t2i_img" alt="生成图片" style="display:none;max-width:100%;border-radius:8px" />
          </div>
        </section>
      </section>
        <section id="page_models" class="page">
          <section class="card">
            <h2>模型管理</h2>
            <div class="row">
              <input id="model_id" placeholder="modelscope id" class="grow" value="qwen/Qwen2.5-0.5B-Instruct">
              <button id="btn_download">下载</button>
              <button id="btn_dl_quant_int8">下载+INT8量化</button>
            </div>
            <div class="row small">
              <input id="include" placeholder="include patterns">
              <input id="exclude" placeholder="exclude patterns">
              <input id="revision" placeholder="revision">
            </div>
            
            <div id="download_status"></div>
          </section>
          <section class="card">
            <div class="row">
              <button id="btn_quant_int8">INT8量化</button>
              <button id="btn_release">释放模型</button>
            </div>
            <div class="list" id="model_list"></div>
          </section>
        </section>
      <section id="page_settings" class="page">
        <section class="card">
          <h2>系统配置</h2>
          <div class="row small">
            <select id="perf_mode" aria-label="Performance mode">
              <option value="LATENCY">Latency</option>
              <option value="THROUGHPUT">Throughput</option>
              <option value="CUMULATIVE_THROUGHPUT" selected>Cumulative Throughput</option>
            </select>
            <button id="btn_wizard" aria-label="Config Wizard">向导</button>
            <button id="btn_clear_cache" aria-label="Clear Cache">清除缓存</button>
            <button id="btn_pipeline" aria-label="Pipeline iGPU+NPU">iGPU+NPU管线</button>
          </div>
          <div class="row small">
            <label><input type="checkbox" id="auto_perf" checked> 自动性能优化</label>
            <label><input type="checkbox" id="hetero_enable" checked> 异构并行(HETERO 管线并行)</label>
          </div>
        </section>
        <section class="card" id="advanced_card">
          <div class="card-header">
            <h2>高级设置</h2>
            <button id="adv_toggle" aria-label="Toggle">▾</button>
          </div>
          <div class="card-body" id="advanced_body">
            <div class="fieldgroup">
              <label for="streams_control">Streams</label>
              <div id="streams_control" class="segmented" role="group" aria-label="Streams">
                <button data-value="1">1</button>
                <button data-value="2">2</button>
                <button data-value="3">3</button>
                <button data-value="4">4</button>
              </div>
            </div>
          <div class="fieldgroup">
            <label>异构策略</label>
            <div class="segmented" role="group" aria-label="HETERO Policy">
              <button data-policy="PIPELINE_PARALLEL" class="active">管线并行</button>
            </div>
          </div>
          <div class="fieldgroup">
            <label>异构平衡</label>
            <div class="segmented" role="group" aria-label="HETERO Balance">
              <button data-hetero-balance="igpu_first">iGPU主导</button>
              <button data-hetero-balance="balanced" class="active">均衡(NPU→GPU→CPU)</button>
              <button data-hetero-balance="npu_first">NPU主导</button>
            </div>
          </div>
            <div class="fieldgroup">
              <label for="tiles_slider">Tiles</label>
              <input id="tiles_slider" type="range" min="1" max="4" step="1" aria-label="Tiles">
              <input id="tiles_value" type="number" min="1" max="4" aria-label="Tiles value">
            </div>
            <div class="fieldgroup">
              <label for="num_requests">并发请求</label>
              <input id="num_requests" type="number" min="1" value="1" aria-label="Num requests">
            </div>
            <div class="card-actions">
              <button id="adv_reset">重置</button>
            </div>
          </div>
        </section>
        <section class="card">
          <h2>设备与环境</h2>
          <div class="fieldgroup">
            <label>设备架构</label>
            <div id="device_arch" class="list"></div>
          </div>
          <div class="fieldgroup">
            <label>硬件型号与内存</label>
            <div id="hardware_view" class="foot"></div>
          </div>
          <div class="fieldgroup">
            <label>OpenVINO Hints</label>
            <div id="ov_hints_view" class="foot"></div>
          </div>
        </section>
        <section class="card">
          <h2>性能</h2>
          <div id="perf" class="foot"></div>
        </section>
      </section>
        <section id="page_about" class="page">
          <section class="card">
            <h2 data-i18n="about_title">关于</h2>
            <p data-i18n="about_intro">AI Funland 是基于 OpenVINO GenAI 的本地 AI 推理与模型管理界面，支持模型下载、INT8/INT4 权重量化、设备选择（CPU/GPU/NPU/NVIDIA）、性能调优，以及支持思考/最终答案拆分的自然聊天体验。</p>
            <div class="sysinfo" id="sysinfo_about"></div>
          </section>
        </section>
    </main>
    <footer class="foot">
      <center><span>V0.1.0 Dev · 2025-11-24 · Powered by <a href="https://hellovm.com">HelloVM</a>  · <a href="https://github.com/hellovm/AI-Funland">Check on Github</a></span></center>
    </footer>
  </div>
  <div id="loading_overlay" class="overlay hidden"><div class="box"><div class="spinner"></div><div id="loading_text">正在初始化模型，首次加载可能需要30-60秒</div><div id="loading_tip" style="display:none">模型加载中，请稍候...</div></div></div>
  <div id="wizard_overlay" class="overlay hidden"><div class="box"><div class="wizard" id="wizard"></div></div></div>
  <script src="/static/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded',function(){
      var acc=document.querySelector('#accelerator');
      var btns=document.querySelectorAll('button[data-hetero-balance]');
      function applyActive(mode){
        btns.forEach(function(b){b.classList.toggle('active',b.getAttribute('data-hetero-balance')===mode)})
      }
      function mapTarget(mode){
        var map={igpu_first:'HETERO:GPU,CPU',balanced:'HETERO:NPU,GPU,CPU',npu_first:'HETERO:NPU,CPU'};
        return map[mode]||map.balanced
      }
      function applyMode(mode){
        applyActive(mode);
        try{localStorage.setItem('hetero_balance',mode)}catch(e){}
        var target=mapTarget(mode);
        var opt=Array.from(acc.options||[]).find(function(o){return o.value===target});
        if(opt){acc.value=target;acc.dispatchEvent(new Event('change'))}
      }
      btns.forEach(function(btn){
        btn.addEventListener('click',function(){
          var mode=btn.getAttribute('data-hetero-balance');
          applyMode(mode);
        })
      })
      var saved=null;try{saved=localStorage.getItem('hetero_balance')}catch(e){}
      if(saved){applyActive(saved)}
    })
  </script>
</body>
</html>
